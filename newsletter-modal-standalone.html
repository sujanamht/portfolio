<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Newsletter Modal - Standalone Version</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Crisp Chat Integration -->
    <script type="text/javascript">
      window.$crisp = [];
      window.CRISP_WEBSITE_ID = "563ca337-9972-46cd-92c9-2931e3798e1c";
      (function () {
        d = document;
        s = d.createElement("script");
        s.src = "https://client.crisp.chat/l.js";
        s.async = 1;
        d.getElementsByTagName("head")[0].appendChild(s);
      })();
    </script>
  </head>
  <body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold text-gray-900 mb-8">
        Newsletter Modal Demo
      </h1>

      <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
        <h2 class="text-xl font-semibold mb-4">Trigger Options</h2>
        <div class="space-x-4">
          <button
            onclick="openNewsletterModal()"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Open Modal Manually
          </button>
          <button
            onclick="triggerTimeBased()"
            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
          >
            Trigger After 5 Seconds
          </button>
          <button
            onclick="triggerScrollBased()"
            class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
          >
            Trigger at 50% Scroll
          </button>
        </div>
      </div>

      <!-- Newsletter Modal -->
      <div
        id="newsletterModal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 hidden"
      >
        <div
          class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 transform transition-all duration-300 scale-100"
        >
          <!-- Success State -->
          <div id="successState" class="text-center hidden">
            <div
              class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <svg
                class="w-8 h-8 text-green-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                />
              </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">
              Sent! Opening chat...
            </h3>
            <p class="text-gray-600">
              Thanks for subscribing! I'll be in touch soon.
            </p>
          </div>

          <!-- Form State -->
          <div id="formState">
            <div class="text-center mb-6">
              <div
                class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"
              >
                <svg
                  class="w-8 h-8 text-blue-600"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                  />
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mb-2">
                Let's Connect!
              </h3>
              <p class="text-gray-600">
                Get in touch and I'll share more about my work and projects.
              </p>
            </div>

            <form id="newsletterForm" class="space-y-4">
              <div>
                <label
                  for="email"
                  class="block text-sm font-medium text-gray-700 mb-2"
                >
                  Email Address
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors"
                  placeholder="your.email@example.com"
                  required
                />
              </div>

              <div class="flex items-start space-x-3">
                <input
                  type="checkbox"
                  id="consent"
                  name="consent"
                  class="mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                  required
                />
                <label for="consent" class="text-sm text-gray-600">
                  I agree to receive updates about Sujana's work and projects.
                  You can unsubscribe at any time.
                </label>
              </div>

              <div
                id="errorMessage"
                class="bg-red-50 border border-red-200 rounded-lg p-3 hidden"
              >
                <p class="text-red-600 text-sm"></p>
              </div>

              <div class="flex space-x-3 pt-2">
                <button
                  type="button"
                  onclick="closeNewsletterModal()"
                  class="flex-1 px-4 py-3 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors font-medium"
                >
                  Maybe Later
                </button>
                <button
                  type="submit"
                  id="submitButton"
                  class="flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium"
                >
                  Connect & Chat
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Demo Content -->
      <div class="bg-white rounded-lg shadow-lg p-6">
        <h2 class="text-xl font-semibold mb-4">Demo Content</h2>
        <p class="text-gray-600 mb-4">
          This is a standalone version of the newsletter modal that can be
          integrated into any website without React. The modal includes all the
          features from the React version:
        </p>
        <ul class="list-disc list-inside text-gray-600 space-y-2">
          <li>Email validation</li>
          <li>Consent checkbox</li>
          <li>Crisp Chat integration</li>
          <li>Automatic message sending</li>
          <li>Responsive design with Tailwind CSS</li>
          <li>Accessibility features (keyboard navigation, ARIA labels)</li>
          <li>Multiple trigger options</li>
        </ul>

        <!-- Scrollable content to test scroll trigger -->
        <div class="mt-8 space-y-4">
          <div
            class="h-96 bg-gray-200 rounded-lg flex items-center justify-center"
          >
            <p class="text-gray-500">
              Scroll down to test scroll-based trigger
            </p>
          </div>
          <div
            class="h-96 bg-gray-200 rounded-lg flex items-center justify-center"
          >
            <p class="text-gray-500">More content...</p>
          </div>
          <div
            class="h-96 bg-gray-200 rounded-lg flex items-center justify-center"
          >
            <p class="text-gray-500">Even more content...</p>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Newsletter Modal Manager
      class NewsletterModalManager {
        constructor() {
          this.isModalOpen = false;
          this.hasShownModal = false;
          this.aboutMeMessage =
            "Hi! I'm Sujana â€” a CS major with a Data Science focus, graduating Dec 2025. I build AI-powered tools in React/TS, Python/Django, and .NET. I also lead the Women in Tech chapter at SELU.";

          this.init();
        }

        init() {
          // Set up form submission
          document
            .getElementById("newsletterForm")
            .addEventListener("submit", (e) => this.handleSubmit(e));

          // Set up keyboard navigation
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && this.isModalOpen) {
              this.closeModal();
            }
          });

          // Set up backdrop click
          document
            .getElementById("newsletterModal")
            .addEventListener("click", (e) => {
              if (e.target === e.currentTarget) {
                this.closeModal();
              }
            });

          // Expose global function
          window.openNewsletterModal = () => this.openModal();
        }

        validateEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
        }

        showError(message) {
          const errorDiv = document.getElementById("errorMessage");
          const errorText = errorDiv.querySelector("p");
          errorText.textContent = message;
          errorDiv.classList.remove("hidden");
        }

        hideError() {
          document.getElementById("errorMessage").classList.add("hidden");
        }

        async handleSubmit(e) {
          e.preventDefault();
          this.hideError();

          const email = document.getElementById("email").value;
          const consent = document.getElementById("consent").checked;
          const submitButton = document.getElementById("submitButton");

          // Validation
          if (!email) {
            this.showError("Please enter your email address");
            return;
          }

          if (!this.validateEmail(email)) {
            this.showError("Please enter a valid email address");
            return;
          }

          if (!consent) {
            this.showError("Please accept the terms to continue");
            return;
          }

          // Show loading state
          submitButton.textContent = "Sending...";
          submitButton.disabled = true;

          try {
            // Optional: Save email to backend/newsletter API
            // await fetch('/api/subscribe', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({ email })
            // });

            // Set email in Crisp chat session
            if (window.$crisp) {
              window.$crisp.push(["set", "user:email", [email]]);
            }

            // Show success state
            this.showSuccess();

            // Send pre-written message to chat
            setTimeout(() => {
              if (window.$crisp) {
                window.$crisp.push([
                  "do",
                  "message:send",
                  [this.aboutMeMessage],
                ]);
                window.$crisp.push(["do", "chat:open"]);
              }
            }, 1000);

            // Close modal after delay
            setTimeout(() => {
              this.closeModal();
              this.onSubscribed(email);
            }, 3000);
          } catch (error) {
            console.error("Error:", error);
            this.showError("Something went wrong. Please try again.");
            submitButton.textContent = "Connect & Chat";
            submitButton.disabled = false;
          }
        }

        showSuccess() {
          document.getElementById("formState").classList.add("hidden");
          document.getElementById("successState").classList.remove("hidden");
        }

        openModal() {
          if (this.hasShownModal) return;

          this.isModalOpen = true;
          this.hasShownModal = true;
          document.getElementById("newsletterModal").classList.remove("hidden");

          // Reset form
          document.getElementById("newsletterForm").reset();
          this.hideError();
          document.getElementById("formState").classList.remove("hidden");
          document.getElementById("successState").classList.add("hidden");

          // Focus on email input
          setTimeout(() => {
            document.getElementById("email").focus();
          }, 100);
        }

        closeModal() {
          this.isModalOpen = false;
          document.getElementById("newsletterModal").classList.add("hidden");
        }

        onSubscribed(email) {
          console.log("User subscribed:", email);
          // Optional: Track subscription event
        }

        // Trigger methods
        triggerTimeBased(delay = 5000) {
          setTimeout(() => {
            this.openModal();
          }, delay);
        }

        triggerScrollBased(threshold = 50) {
          const handleScroll = () => {
            if (!this.hasShownModal) {
              const scrollTop =
                window.pageYOffset || document.documentElement.scrollTop;
              const scrollHeight =
                document.documentElement.scrollHeight - window.innerHeight;
              const scrollPercentage = (scrollTop / scrollHeight) * 100;

              if (scrollPercentage >= threshold) {
                this.openModal();
                window.removeEventListener("scroll", handleScroll);
              }
            }
          };

          window.addEventListener("scroll", handleScroll);
        }
      }

      // Initialize the modal manager
      const modalManager = new NewsletterModalManager();

      // Global functions for demo buttons
      function openNewsletterModal() {
        modalManager.openModal();
      }

      function closeNewsletterModal() {
        modalManager.closeModal();
      }

      function triggerTimeBased() {
        modalManager.triggerTimeBased(5000);
      }

      function triggerScrollBased() {
        modalManager.triggerScrollBased(50);
      }

      // Auto-trigger after 10 seconds for demo
      setTimeout(() => {
        if (!modalManager.hasShownModal) {
          modalManager.openModal();
        }
      }, 10000);
    </script>
  </body>
</html>
